---
import axios from "axios";

const fetchNews = async () => {
  try {
    const response = await axios.get("http://west.edu.mn:3000/api/v1/news");

    if (!response.data.success || !Array.isArray(response.data.news)) {
      throw new Error("API-аас буруу форматтай өгөгдөл ирлээ.");
    }

    // 3 зураг нэг дор харуулахын тулд 6 мэдээ авна (дараагийн ээлжийн зураг хэрэгтэй учир)
    return response.data.news.slice(0, 9);
  } catch (error) {
    console.error("API Fetch алдаа:", error);
    return [];
  }
};

const newsList = await fetchNews();
---

<div class="relative w-full mx-auto mt-5">
  <div class="overflow-hidden rounded-lg">
    {
      newsList.length > 0 ? (
        <div
          id="slider"
          class="flex transition-transform duration-700 ease-in-out"
        >
          {newsList.map((item, i) => (
            <div class="w-1/3 px-2 shrink-0" key={i}>
              <div class="relative h-64 rounded-lg overflow-hidden">
                <img
                  src={item.image}
                  alt={item.title}
                  class="w-full h-full align-middle object-cover "
                />
                <div class=" absolute  bottom-0 left-0 w-full h-25  bg-blue-900 bg-opacity-50 text-white text-center align-middle p-2">
                  <h2 class=" text-xl font-semibold align-middle ">
                    {item.title}
                  </h2>
                </div>
              </div>
            </div>
          ))}
        </div>
      ) : (
        <p class="text-center">Мэдээлэл ачааллаж байна...</p>
      )
    }
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    let currentIndex = 0;
    const slider = document.getElementById("slider");
    const totalItems = slider.children.length;

    if (totalItems <= 3) return; // 3-аас цөөн зураг байвал хөдөлгөхгүй

    setInterval(() => {
      currentIndex = (currentIndex + 1) % totalItems; // 3-аар шилжих
      slider.style.transform = `translateX(-${(currentIndex / 3) * 100}%)`;
    }, 3000);
  });
</script>
