---
import "../styles/global.css";
import { twMerge } from "tailwind-merge";
import axios from "axios";

const axiosNews = async () => {
  try {
    const response = await axios.get("http://west.edu.mn:3000/api/v1/news");

    if (!response.data.success || !Array.isArray(response.data.news)) {
      throw new Error("API-–∞–∞—Å –±—É—Ä—É—É —Ñ–æ—Ä–º–∞—Ç—Ç–∞–π ”©–≥”©–≥–¥”©–ª –∏—Ä–ª—ç—ç.");
    }

    return response.data.news.slice(0, 3).map((news) => { // ‚úÖ –ó”©–≤—Ö”©–Ω —ç—Ö–Ω–∏–π 3 –º—ç–¥—ç—ç–≥ –∞–≤–∞—Ö
      const imageBlock = news.blocks.find(
        (block) => block.type === "simpleImage" || block.type === "image"
      );

      // ‚úÖ –û–≥–Ω–æ–æ–≥ YYYY.MM.DD —Ñ–æ—Ä–º–∞—Ç —Ä—É—É —Ö”©—Ä–≤“Ø“Ø–ª—ç—Ö
      const dateObj = new Date(news.created_at);
      const formattedDate = `${dateObj.getFullYear()}.${String(dateObj.getMonth() + 1).padStart(2, "0")}.${String(dateObj.getDate()).padStart(2, "0")}`;
      const formattedTime = `${String(dateObj.getHours()).padStart(2, "0")}:${String(dateObj.getMinutes()).padStart(2, "0")}`;

      // ‚úÖ –ì–∞—Ä—á–≥–∏–π–≥ 150 —Ç—ç–º–¥—ç–≥—Ç—ç–¥ —Ö—è–∑–≥–∞–∞—Ä–ª–∞—Ö
      const shortTitle = news.title.length > 66 ? news.title.slice(0, 66) + "..." : news.title;

      // ‚úÖ –¢–∞–π–ª–±–∞—Ä—ã–≥ "paragraph" –±–ª–æ–∫–æ–æ—Å –∞–≤–∞—Ö, 500 —Ç—ç–º–¥—ç–≥—Ç—ç–¥ —Ö—è–∑–≥–∞–∞—Ä–ª–∞—Ö
      const paragraphBlock = news.blocks.find((block) => block.type === "paragraph");
      const description = paragraphBlock ? (paragraphBlock.data.text.length > 500 ? paragraphBlock.data.text.slice(0, 500) + "..." : paragraphBlock.data.text) : "";

      return {
        title: shortTitle,
        date: formattedDate,
         time: formattedTime,
        description: description,
        image: imageBlock ? imageBlock.data.file.url : "",
      };
    });
  } catch (error) {
    console.error("API axios –∞–ª–¥–∞–∞:", error);
    return [];
  }
};

// üü¢ API-—Å –º—ç–¥—ç—ç –∞–≤–∞—Ö
const newsCardList = await axiosNews();
---
<div class="bg-white ">
<div class="flex  items-center text-xl px-9 pt-9 pb-9 text-blue-900 font-medium">
  <div class="flex-1">
    <h2 class="text-3xl">–ó–û–•–ò–û–ù –ë–ê–ô–ì–£–£–õ–ê–ì–î–ê–ñ <br/>–ë–£–ô –ê–†–ì–ê –•–≠–ú–ñ–≠–≠</h2>
    <p class="text-base mt-2">
      –°–£–†–ì–£–£–õ–ò–ô–ù –•–≠–ú–ñ–≠–≠–ù–î –ó–û–•–ò–û–ù <br/> –ë–ê–ô–ì–£–£–õ–ê–ì–î–ê–ñ –ë–£–ô –ê–†–ì–ê –•–≠–ú–ñ–≠–≠
    </p>
  </div>
  <a href="" class="p-2 px-7 border text-base text-center rounded-2xl font-bold">
    –ë–£–°–ê–î –ê–†–ì–ê <br/>–•–≠–ú–ñ–≠–≠
  </a>
</div>



<!-- üü¢ –ó”©–≤—Ö”©–Ω 3 –º—ç–¥—ç—ç–Ω–∏–π –∫–∞—Ä—Ç—É—É–¥ -->
<div class=" bg-white border-b-2 pb-10 grid grid-cols-1 md:grid-cols-3 gap-6 px-10">
  {newsCardList.map((item) => (
    <div class=" bg-white rounded-lg shadow-md overflow-hidden">
      <img
        src={item.image}
        alt={item.title}
        class="w-full h-80 object-cover"
      />
      <div class="p-4">
        <p class="text-gray-600 text-sm flex items-center">
  <!-- –û–≥–Ω–æ–æ–Ω—ã icon -->
  <img src="/public/image/schedule.png" alt="schedule icon" class="h-5 w-5 mr-2" />
  {item.date}  
  <!-- –¶–∞–≥–∏–π–Ω icon -->
  <img src="/public/image/clock.png" alt="clock icon" class="h-5 w-5 ml-4 mr-2" />
  {item.time}
</p>
        <h3 class="text-2xl font-semibold text-gray-800 line-clamp-2 overflow-hidden">
  {item.title}
</h3>
        <p class="text-gray-600 text-sm mt-2 line-clamp-3">
          {item.description} <!-- ‚úÖ 500 —Ç—ç–º–¥—ç–≥—Ç—Ç—ç–π —Ç–∞–π–ª–±–∞—Ä -->
        </p>
         <!-- ‚úÖ –î—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π —Ç–æ–≤—á -->
  <button class="mt-3 px-8 py-4 bg-white text-gray-800 font-medium border border-gray-300 rounded-4xl transition duration-300 hover:text-blue-500">
    –î—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π
  </button>
      </div>
    </div>
  ))}
</div>
</div>

